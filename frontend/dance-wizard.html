<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dance Wizard</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(160deg, #1e3c72 0%, #2a5298 100%);
            color: #f7f7f7;
            height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 10px;
            overflow: hidden;
        }
        .app {
            width: 100%;
            max-width: 520px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 16px;
            padding: 10px;
            margin: 5px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
            max-height: 100%;
            overflow: hidden;
        }
        header h1 {
            font-size: 1.6rem;
            margin-bottom: 6px;
        }
        header p {
            font-size: 0.95rem;
            color: #d6e2ff;
            margin-bottom: 16px;
            line-height: 1.4;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }
        .controls button {
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 0.85rem;
            font-weight: 600;
            background: #f3f6ff;
            color: #1a2a4f;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .controls button:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25); }
        .controls button.active { background: #ffd166; color: #362300; }
        .controls button.filter-active { background: #667eea; color: white; }
        #style-salsa { background: #ff6b6b; color: white; }
        #style-salsa.active { 
            background: #d32f2f; 
            color: white; 
            box-shadow: 0 0 20px rgba(211, 47, 47, 0.9), 0 0 10px rgba(211, 47, 47, 0.5);
            border: 3px solid #ff1744;
            font-weight: 700;
        }
        #style-bachata { background: #4ecdc4; color: white; }
        #style-bachata.active { 
            background: #00838f; 
            color: white; 
            box-shadow: 0 0 20px rgba(0, 131, 143, 0.9), 0 0 10px rgba(0, 131, 143, 0.5);
            border: 3px solid #00bcd4;
            font-weight: 700;
        }
        #complexity-filter { background: #95a5a6; color: white; }
        #complexity-filter.filter-active { background: #7f8c8d; color: white; }
        #previous-mission { background: #a29bfe; color: white; }
        #try-again {
            background: #fd79a8;
            color: white;
            animation: buttonPulsePink 2s ease-in-out infinite;
        }
        #next-mission { 
            background: #00b894; 
            color: white; 
            animation: buttonPulse 2s ease-in-out infinite;
        }
        @keyframes buttonPulsePink {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(253, 121, 168, 0.75);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 8px rgba(253, 121, 168, 0);
            }
        }
        @keyframes buttonPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.7);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 8px rgba(0, 184, 148, 0);
            }
        }
        #select-mission { background: #fdcb6e; color: #2d3436; }
        .controls-break { flex-basis: 100%; }
        .toast {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translate(-50%, -8px);
            padding: 10px 14px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.75);
            color: #fff;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 0.02em;
            opacity: 0;
            pointer-events: none;
            z-index: 3000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
            transition: opacity 0.18s ease, transform 0.18s ease;
            white-space: nowrap;
        }
        .toast.show { opacity: 1; transform: translate(-50%, 0); }
        .toast.success { background: rgba(0, 184, 148, 0.92); }
        .toast.error { background: rgba(255, 99, 132, 0.92); }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: linear-gradient(160deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
            max-height: 90vh;
        }
        .welcome-modal {
            height: auto;
            max-height: 85vh;
        }
        #close-welcome:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .modal h3 {
            margin-bottom: 16px;
            font-size: 1.2rem;
            color: #fff;
            flex-shrink: 0;
        }
        .complexity-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .complexity-option {
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #fff;
            font-weight: 500;
        }
        .complexity-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(4px);
        }
        .complexity-option.selected {
            border-color: #ffd166;
            background: rgba(255, 209, 102, 0.2);
        }
        .complexity-option.clear {
            margin-top: 8px;
            background: rgba(255, 107, 107, 0.2);
            border-color: rgba(255, 107, 107, 0.5);
        }
        .complexity-option.clear:hover {
            background: rgba(255, 107, 107, 0.3);
        }
        .mission-search {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 0.9rem;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        .mission-search::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .mission-search:focus {
            outline: none;
            border-color: #ffd166;
            background: rgba(255, 255, 255, 0.15);
        }
        .mission-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .mission-option {
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #fff;
            font-weight: 500;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .mission-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(4px);
        }
        .mission-option .mission-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .mission-option .mission-details {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        .stage {
            position: relative;
            width: max(200px, min(95%, 400px, calc(500px / 1.2)));
            max-width: 400px;
            max-height: 500px;
            aspect-ratio: 1 / 1.2;
            margin: 0 auto;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.35);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            overflow: hidden;
            touch-action: manipulation;
        }
        .part {
            position: absolute;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.75);
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            cursor: pointer;
            user-select: none;
            transition: transform 0.12s ease, background 0.12s ease, box-shadow 0.12s ease;
        }
        .part:active { transform: scale(0.96); }
        .part[data-part="neck"] {
            width: 36px;
            height: 36px;
            font-size: 0.4rem;
        }
        .part[data-part="belly"] {
            width: 36px;
            height: 36px;
            font-size: 0.4rem;
        }
        .part.target { background: rgba(255, 209, 102, 0.55); box-shadow: 0 0 14px rgba(255, 209, 102, 0.8); }
        .part.correct {
            background: rgba(80, 200, 120, 0.6);
            animation: correctPulse 0.7s ease-in-out;
        }
        .part.wrong {
            background: rgba(255, 99, 132, 0.65);
            animation: wrongPulse 0.7s ease-in-out;
        }
        .status {
            margin-top: 0px;
            margin-bottom: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 12px;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .sequence-row {
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .sequence {
            font-size: 0.85rem;
            color: #cde1ff;
            text-align: center;
        }
        .sequence span {
            display: inline-block;
            margin: 2px 0 0 0;
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.12);
        }
        .sequence span.active {
            background: #ffd166;
            color: #362300;
            font-weight: 600;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .live-timer {
            margin-top: 0;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 800;
            letter-spacing: 0.02em;
            color: rgba(255, 255, 255, 0.95);
            min-width: 58px; /* keeps layout steady as numbers change */
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 209, 102, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 8px rgba(255, 209, 102, 0); }
        }
        @keyframes correctPulse {
            0% { box-shadow: 0 0 0 0 rgba(80, 200, 120, 0.7); }
            50% { box-shadow: 0 0 0 20px rgba(80, 200, 120, 0); }
            100% { box-shadow: 0 0 0 0 rgba(80, 200, 120, 0); }
        }
        @keyframes wrongPulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 99, 132, 0.75); }
            50% { box-shadow: 0 0 0 20px rgba(255, 99, 132, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 99, 132, 0); }
        }
        /* Fun ambient motion: animate an inner wrapper so the part's absolute position never shifts */
        .part .part-inner {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none; /* keep taps on the .part itself */
            will-change: transform;
        }
        @keyframes randomPulse1 {
            0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
            25% { transform: translate(20px, -20px) scale(1.05) rotate(1deg); }
            50% { transform: translate(-25px, 20px) scale(1.08) rotate(-1.5deg); }
            75% { transform: translate(20px, 25px) scale(1.03) rotate(0.8deg); }
        }
        @keyframes randomPulse2 {
            0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
            20% { transform: translate(-20px, 15px) scale(1.04) rotate(-1deg); }
            50% { transform: translate(25px, -15px) scale(1.1) rotate(1.8deg); }
            80% { transform: translate(-15px, -25px) scale(1.03) rotate(-0.6deg); }
        }
        @keyframes randomPulse3 {
            0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
            30% { transform: translate(15px, 25px) scale(1.03) rotate(0.5deg); }
            60% { transform: translate(-20px, -20px) scale(1.06) rotate(-1.2deg); }
        }
        @keyframes randomPulse4 {
            0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
            25% { transform: translate(25px, 15px) scale(1.06) rotate(1.3deg); }
            55% { transform: translate(-25px, -15px) scale(1.12) rotate(-2deg); }
            85% { transform: translate(15px, -25px) scale(1.04) rotate(0.9deg); }
        }
        @keyframes randomPulse5 {
            0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
            35% { transform: translate(-20px, 20px) scale(1.05) rotate(-1.4deg); }
            70% { transform: translate(20px, -20px) scale(1.08) rotate(1.6deg); }
        }
        .part.random-pulse-1 .part-inner { animation: randomPulse1 2.5s ease-in-out infinite; }
        .part.random-pulse-2 .part-inner { animation: randomPulse2 3s ease-in-out infinite; }
        .part.random-pulse-3 .part-inner { animation: randomPulse3 2.2s ease-in-out infinite; }
        .part.random-pulse-4 .part-inner { animation: randomPulse4 3.3s ease-in-out infinite; }
        .part.random-pulse-5 .part-inner { animation: randomPulse5 2.8s ease-in-out infinite; }
        .complexity {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            vertical-align: middle;
        }
        .complexity-1 { background: rgba(80, 200, 120, 0.3); color: #50c878; }
        .complexity-2 { background: rgba(255, 209, 102, 0.3); color: #ffd166; }
        .complexity-3 { background: rgba(255, 165, 0, 0.3); color: #ffa500; }
        .complexity-4 { background: rgba(255, 107, 107, 0.3); color: #ff6b6b; }
        .complexity-5 { background: rgba(200, 50, 50, 0.3); color: #c83232; }
        @media (min-width: 900px) {
            body { padding: 40px; }
            .app { max-width: 680px; }
            .stage { aspect-ratio: 1 / 1.1; max-height: 500px; }
            .part { width: 60px; height: 60px; font-size: 0.68rem; }
            .part[data-part="neck"] {
                width: 44px;
                height: 44px;
                font-size: 0.5rem;
            }
            .part[data-part="belly"] {
                width: 44px;
                height: 44px;
                font-size: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <h1>Welcome to Dance Wizard</h1>
        </header>

        <div class="controls">
            <button id="style-salsa" class="active" type="button">Salsa</button>
            <button id="style-bachata" type="button">Bachata</button>
            <button id="complexity-filter" type="button">Complexity</button>
            <span class="controls-break"></span>
            <button id="previous-mission" type="button">Previous Mission</button>
            <button id="try-again" type="button">Start</button>
            <button id="next-mission" type="button">Next Mission</button>
            <button id="select-mission" type="button">Select Mission</button>
        </div>

        <div class="modal-overlay" id="complexity-modal">
            <div class="modal">
                <h3>Select Complexity Level</h3>
                <div class="complexity-options">
                    <div class="complexity-option" data-complexity="1">
                        <span class="complexity complexity-1">Easy (1/5)</span> - Simple, short sequences
                    </div>
                    <div class="complexity-option" data-complexity="2">
                        <span class="complexity complexity-2">Easy-Medium (2/5)</span> - Basic patterns
                    </div>
                    <div class="complexity-option" data-complexity="3">
                        <span class="complexity complexity-3">Medium (3/5)</span> - Moderate complexity
                    </div>
                    <div class="complexity-option" data-complexity="4">
                        <span class="complexity complexity-4">Medium-Hard (4/5)</span> - Longer, complex sequences
                    </div>
                    <div class="complexity-option" data-complexity="5">
                        <span class="complexity complexity-5">Hard (5/5)</span> - Most challenging
                    </div>
                    <div class="complexity-option clear" data-complexity="0">
                        Clear Filter (Random from all)
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="select-mission-modal">
            <div class="modal">
                <h3>Select Mission</h3>
                <input type="text" id="mission-search" class="mission-search" placeholder="Search missions by name..." autocomplete="off">
                <div class="mission-options" id="mission-options">
                    <!-- Missions will be populated here -->
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="welcome-modal">
            <div class="modal welcome-modal">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="margin: 0;">Welcome to Dance Wizard! ðŸŽ­</h3>
                    <button id="close-welcome" style="background: rgba(255, 255, 255, 0.2); border: none; color: #fff; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: background 0.2s;">Ã—</button>
                </div>
                <div class="welcome-content" style="flex: 1; overflow-y: auto; line-height: 1.6;">
                    <p style="margin-bottom: 16px; color: #d6e2ff;">
                        <strong style="color: #ffd166;">Dance Wizard</strong> is a fast-paced rhythm game where you master dance sequences by tapping body parts in the correct order as quickly as possible!
                    </p>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #ffd166; margin-bottom: 8px; font-size: 1rem;">ðŸŽ¯ How to Play:</h4>
                        <ol style="margin-left: 20px; color: #d6e2ff;">
                            <li style="margin-bottom: 8px;"><strong>Choose your style:</strong> Select <span style="color: #ff6b6b;">Salsa</span> or <span style="color: #4ecdc4;">Bachata</span> to begin</li>
                            <li style="margin-bottom: 8px;"><strong>Start a mission:</strong> Click <span style="color: #00b894;">"Next Mission"</span> for a random sequence, or <span style="color: #fdcb6e;">"Select Mission"</span> to choose a specific one</li>
                            <li style="margin-bottom: 8px;"><strong>Watch the indicator:</strong> The next body part to tap will be shown in the center with a pulsing effect</li>
                            <li style="margin-bottom: 8px;"><strong>Tap fast!</strong> Press the correct body parts on the stage in the exact sequence shown</li>
                            <li style="margin-bottom: 8px;"><strong>Beat your record:</strong> Complete sequences as fast as possible to set new records</li>
                        </ol>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #ffd166; margin-bottom: 8px; font-size: 1rem;">ðŸŽ® Controls:</h4>
                        <ul style="margin-left: 20px; color: #d6e2ff;">
                            <li style="margin-bottom: 6px;"><span style="color: #00b894;">Next Mission</span> - Start a new sequence</li>
                            <li style="margin-bottom: 6px;"><span style="color: #fd79a8;">Try Again</span> - Restart the current mission</li>
                            <li style="margin-bottom: 6px;"><span style="color: #a29bfe;">Previous Mission</span> - Go back to the last mission</li>
                            <li style="margin-bottom: 6px;"><span style="color: #95a5a6;">Complexity</span> - Filter missions by difficulty (1-5)</li>
                        </ul>
                    </div>
                    <div style="background: rgba(255, 209, 102, 0.15); padding: 12px; border-radius: 8px; border-left: 3px solid #ffd166;">
                        <p style="margin: 0; color: #ffd166; font-weight: 600;">ðŸ’¡ Tip:</p>
                        <p style="margin: 4px 0 0 0; color: #d6e2ff; font-size: 0.9rem;">
                            The faster you complete a sequence, the better your record! Challenge yourself to beat your best time and compete with others.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="status" id="status">
            <div id="status-message">Tap "Next Mission" to begin a sequence.</div>
            <div class="sequence-row">
                <div class="sequence" id="sequence"></div>
                <div class="live-timer" id="live-timer"></div>
            </div>
        </div>

        <div class="stage" id="stage">
            <div class="part" data-part="head" style="top: 3%; left: 50%; transform: translate(-50%, 0);">Head</div>
            <div class="part" data-part="left-shoulder" style="top: 23%; left: 20%;">L Shoulder</div>
            <div class="part" data-part="neck" style="top: 18%; left: 50%; transform: translate(-50%, 0);">Neck</div>
            <div class="part" data-part="right-shoulder" style="top: 23%; right: 20%;">R Shoulder</div>
            <div class="part" data-part="left-hand" style="top: 36%; left: 8%;">L Hand</div>
            <div class="part" data-part="right-hand" style="top: 36%; right: 8%;">R Hand</div>
            <div class="part" data-part="chest" style="top: 29%; left: 50%; transform: translate(-50%, 0);">Chest</div>
            <div class="part" data-part="belly" style="top: 44%; left: 50%; transform: translate(-50%, 0);">Belly</div>
            <div class="part" data-part="left-hip" style="top: 54%; left: 30%;">L Hip</div>
            <div class="part" data-part="right-hip" style="top: 54%; right: 30%;">R Hip</div>
            <div class="part" data-part="left-upper-leg" style="top: 69%; left: 28%;">L Upper Leg</div>
            <div class="part" data-part="right-upper-leg" style="top: 69%; right: 28%;">R Upper Leg</div>
            <div class="part" data-part="left-lower-leg" style="top: 84%; left: 28%;">L Lower Leg</div>
            <div class="part" data-part="right-lower-leg" style="top: 84%; right: 28%;">R Lower Leg</div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const salsaChunks = {
            shineHead: ["head", "left-shoulder", "right-shoulder", "chest", "head"],
            shineHands: ["left-hand", "right-hand", "left-shoulder", "right-shoulder", "neck"],
            chestPop: ["chest", "head", "chest", "left-shoulder", "right-shoulder"],
            hipSwitch: ["left-hip", "right-hip", "left-hip", "right-hip", "belly"],
            hipCross: ["left-hip", "chest", "right-hip", "chest", "left-hip"],
            bodyWaveUp: ["belly", "chest", "neck", "head", "chest"],
            bodyWaveDown: ["head", "neck", "chest", "belly", "right-hip"],
            footworkBasic: ["left-upper-leg", "right-upper-leg", "left-lower-leg", "right-lower-leg", "chest"],
            footworkLadder: ["left-lower-leg", "left-upper-leg", "right-upper-leg", "right-lower-leg", "belly"],
            turnPrep: ["right-shoulder", "chest", "left-shoulder", "head", "right-hip"],
            turnSpiral: ["head", "left-shoulder", "chest", "right-shoulder", "left-hip"],
            fullBody: ["head", "neck", "chest", "belly", "left-hip"],
        };

        const bachataChunks = {
            sensualWave: ["head", "neck", "chest", "belly", "right-hip"],
            waveReturn: ["right-hip", "belly", "chest", "neck", "head"],
            hipCircle: ["left-hip", "belly", "right-hip", "belly", "left-hip"],
            hipSway: ["left-hip", "right-hip", "left-hip", "right-hip", "belly"],
            shoulderRoll: ["left-shoulder", "neck", "right-shoulder", "chest", "left-shoulder"],
            handToHip: ["left-hand", "left-hip", "right-hand", "right-hip", "chest"],
            handsFrame: ["left-hand", "right-hand", "neck", "chest", "belly"],
            stepTouch: ["left-lower-leg", "right-lower-leg", "left-upper-leg", "right-upper-leg", "belly"],
            stepSync: ["left-upper-leg", "left-lower-leg", "right-lower-leg", "right-upper-leg", "chest"],
            bodyRoll: ["chest", "belly", "left-hip", "right-hip", "chest"],
            headAccent: ["head", "neck", "head", "left-shoulder", "right-shoulder"],
            softWave: ["neck", "chest", "belly", "left-hip", "right-hip"],
        };

        const missions = {
            // NOTE: Complexity â†’ move count:
            // 1:5 moves, 2:10 moves, 3:15 moves, 4:20 moves, 5:25 moves
            salsa: [
                // Complexity 1 (4)
                { name: "Salsa Head-Shoulder Shine", complexity: 1, sequence: [...salsaChunks.shineHead] },
                { name: "Salsa Hip Switch Mini", complexity: 1, sequence: [...salsaChunks.hipSwitch] },
                { name: "Salsa Chest Pop Mini", complexity: 1, sequence: [...salsaChunks.chestPop] },
                { name: "Salsa Footwork Mini", complexity: 1, sequence: [...salsaChunks.footworkBasic] },

                // Complexity 2 (6) - 10 moves
                { name: "Salsa Shine + Hands", complexity: 2, sequence: [...salsaChunks.shineHead, ...salsaChunks.shineHands] },
                { name: "Salsa Hip Switch + Chest Pop", complexity: 2, sequence: [...salsaChunks.hipSwitch, ...salsaChunks.chestPop] },
                { name: "Salsa Full Body + Hip Cross", complexity: 2, sequence: [...salsaChunks.fullBody, ...salsaChunks.hipCross] },
                { name: "Salsa Footwork + Turn Prep", complexity: 2, sequence: [...salsaChunks.footworkBasic, ...salsaChunks.turnPrep] },
                { name: "Salsa Wave Down + Hip Switch", complexity: 2, sequence: [...salsaChunks.bodyWaveDown, ...salsaChunks.hipSwitch] },
                { name: "Salsa Ladder + Chest Pop", complexity: 2, sequence: [...salsaChunks.footworkLadder, ...salsaChunks.chestPop] },

                // Complexity 3 (10) - 15 moves
                { name: "Salsa Triple Shine Circuit", complexity: 3, sequence: [...salsaChunks.shineHead, ...salsaChunks.shineHands, ...salsaChunks.chestPop] },
                { name: "Salsa Hip Ladder Flow", complexity: 3, sequence: [...salsaChunks.hipSwitch, ...salsaChunks.footworkLadder, ...salsaChunks.hipCross] },
                { name: "Salsa Turn + Footwork + Shine", complexity: 3, sequence: [...salsaChunks.turnPrep, ...salsaChunks.footworkBasic, ...salsaChunks.shineHead] },
                { name: "Salsa Wave Up Combo", complexity: 3, sequence: [...salsaChunks.bodyWaveUp, ...salsaChunks.fullBody, ...salsaChunks.hipSwitch] },
                { name: "Salsa Spiral Prep Combo", complexity: 3, sequence: [...salsaChunks.turnSpiral, ...salsaChunks.turnPrep, ...salsaChunks.shineHands] },
                { name: "Salsa Footwork Builder", complexity: 3, sequence: [...salsaChunks.footworkBasic, ...salsaChunks.footworkLadder, ...salsaChunks.chestPop] },
                { name: "Salsa Hip Focus Circuit", complexity: 3, sequence: [...salsaChunks.hipCross, ...salsaChunks.hipSwitch, ...salsaChunks.fullBody] },
                { name: "Salsa Shine to Turn", complexity: 3, sequence: [...salsaChunks.shineHands, ...salsaChunks.turnPrep, ...salsaChunks.shineHead] },
                { name: "Salsa Wave Down Builder", complexity: 3, sequence: [...salsaChunks.bodyWaveDown, ...salsaChunks.chestPop, ...salsaChunks.hipSwitch] },
                { name: "Salsa Spiral Footwork Mix", complexity: 3, sequence: [...salsaChunks.turnSpiral, ...salsaChunks.footworkLadder, ...salsaChunks.turnPrep] },

                // Complexity 4 (18) - 20 moves
                { name: "Salsa Full Body Marathon I", complexity: 4, sequence: [...salsaChunks.fullBody, ...salsaChunks.bodyWaveDown, ...salsaChunks.hipSwitch, ...salsaChunks.footworkBasic] },
                { name: "Salsa Full Body Marathon II", complexity: 4, sequence: [...salsaChunks.bodyWaveUp, ...salsaChunks.fullBody, ...salsaChunks.hipCross, ...salsaChunks.turnPrep] },
                { name: "Salsa Turn & Shine Builder I", complexity: 4, sequence: [...salsaChunks.turnPrep, ...salsaChunks.shineHead, ...salsaChunks.turnSpiral, ...salsaChunks.shineHands] },
                { name: "Salsa Turn & Shine Builder II", complexity: 4, sequence: [...salsaChunks.shineHands, ...salsaChunks.turnPrep, ...salsaChunks.shineHead, ...salsaChunks.turnSpiral] },
                { name: "Salsa Hip & Footwork Run I", complexity: 4, sequence: [...salsaChunks.hipSwitch, ...salsaChunks.footworkLadder, ...salsaChunks.hipCross, ...salsaChunks.footworkBasic] },
                { name: "Salsa Hip & Footwork Run II", complexity: 4, sequence: [...salsaChunks.footworkBasic, ...salsaChunks.hipSwitch, ...salsaChunks.footworkLadder, ...salsaChunks.hipCross] },
                { name: "Salsa Shine Circuit Long I", complexity: 4, sequence: [...salsaChunks.shineHead, ...salsaChunks.shineHands, ...salsaChunks.chestPop, ...salsaChunks.shineHead] },
                { name: "Salsa Shine Circuit Long II", complexity: 4, sequence: [...salsaChunks.shineHands, ...salsaChunks.chestPop, ...salsaChunks.shineHead, ...salsaChunks.shineHands] },
                { name: "Salsa Wave & Hip Groove I", complexity: 4, sequence: [...salsaChunks.bodyWaveDown, ...salsaChunks.hipSwitch, ...salsaChunks.bodyWaveUp, ...salsaChunks.hipCross] },
                { name: "Salsa Wave & Hip Groove II", complexity: 4, sequence: [...salsaChunks.hipCross, ...salsaChunks.bodyWaveUp, ...salsaChunks.hipSwitch, ...salsaChunks.bodyWaveDown] },
                { name: "Salsa Spiral Ladder Run I", complexity: 4, sequence: [...salsaChunks.turnSpiral, ...salsaChunks.footworkLadder, ...salsaChunks.turnPrep, ...salsaChunks.chestPop] },
                { name: "Salsa Spiral Ladder Run II", complexity: 4, sequence: [...salsaChunks.chestPop, ...salsaChunks.turnPrep, ...salsaChunks.footworkLadder, ...salsaChunks.turnSpiral] },
                { name: "Salsa Chest-Shoulder Drive I", complexity: 4, sequence: [...salsaChunks.chestPop, ...salsaChunks.shineHead, ...salsaChunks.turnPrep, ...salsaChunks.chestPop] },
                { name: "Salsa Chest-Shoulder Drive II", complexity: 4, sequence: [...salsaChunks.shineHead, ...salsaChunks.chestPop, ...salsaChunks.shineHands, ...salsaChunks.turnPrep] },
                { name: "Salsa Footwork Marathon I", complexity: 4, sequence: [...salsaChunks.footworkBasic, ...salsaChunks.footworkLadder, ...salsaChunks.footworkBasic, ...salsaChunks.hipSwitch] },
                { name: "Salsa Footwork Marathon II", complexity: 4, sequence: [...salsaChunks.footworkLadder, ...salsaChunks.footworkBasic, ...salsaChunks.hipCross, ...salsaChunks.footworkLadder] },
                { name: "Salsa Wave-Prep Blend I", complexity: 4, sequence: [...salsaChunks.bodyWaveDown, ...salsaChunks.turnPrep, ...salsaChunks.fullBody, ...salsaChunks.shineHands] },
                { name: "Salsa Wave-Prep Blend II", complexity: 4, sequence: [...salsaChunks.shineHands, ...salsaChunks.fullBody, ...salsaChunks.turnPrep, ...salsaChunks.bodyWaveUp] },

                // Complexity 5 (22) - 25 moves
                { name: "Salsa Ultimate Shine Marathon I", complexity: 5, sequence: [...salsaChunks.shineHead, ...salsaChunks.shineHands, ...salsaChunks.chestPop, ...salsaChunks.shineHead, ...salsaChunks.shineHands] },
                { name: "Salsa Ultimate Shine Marathon II", complexity: 5, sequence: [...salsaChunks.shineHands, ...salsaChunks.shineHead, ...salsaChunks.chestPop, ...salsaChunks.shineHands, ...salsaChunks.shineHead] },
                { name: "Salsa Hip-Footwork Gauntlet I", complexity: 5, sequence: [...salsaChunks.hipSwitch, ...salsaChunks.footworkBasic, ...salsaChunks.hipCross, ...salsaChunks.footworkLadder, ...salsaChunks.hipSwitch] },
                { name: "Salsa Hip-Footwork Gauntlet II", complexity: 5, sequence: [...salsaChunks.footworkLadder, ...salsaChunks.hipCross, ...salsaChunks.footworkBasic, ...salsaChunks.hipSwitch, ...salsaChunks.hipCross] },
                { name: "Salsa Turn Lab I", complexity: 5, sequence: [...salsaChunks.turnPrep, ...salsaChunks.turnSpiral, ...salsaChunks.turnPrep, ...salsaChunks.shineHead, ...salsaChunks.turnSpiral] },
                { name: "Salsa Turn Lab II", complexity: 5, sequence: [...salsaChunks.turnSpiral, ...salsaChunks.turnPrep, ...salsaChunks.shineHands, ...salsaChunks.turnPrep, ...salsaChunks.turnSpiral] },
                { name: "Salsa Full Body Wave Gauntlet I", complexity: 5, sequence: [...salsaChunks.bodyWaveDown, ...salsaChunks.fullBody, ...salsaChunks.bodyWaveUp, ...salsaChunks.hipSwitch, ...salsaChunks.fullBody] },
                { name: "Salsa Full Body Wave Gauntlet II", complexity: 5, sequence: [...salsaChunks.fullBody, ...salsaChunks.bodyWaveUp, ...salsaChunks.bodyWaveDown, ...salsaChunks.hipCross, ...salsaChunks.bodyWaveUp] },
                { name: "Salsa Spiral Footwork Gauntlet I", complexity: 5, sequence: [...salsaChunks.turnSpiral, ...salsaChunks.footworkLadder, ...salsaChunks.turnPrep, ...salsaChunks.footworkBasic, ...salsaChunks.turnSpiral] },
                { name: "Salsa Spiral Footwork Gauntlet II", complexity: 5, sequence: [...salsaChunks.footworkBasic, ...salsaChunks.turnPrep, ...salsaChunks.turnSpiral, ...salsaChunks.footworkLadder, ...salsaChunks.turnPrep] },
                { name: "Salsa Chest Pop Endurance I", complexity: 5, sequence: [...salsaChunks.chestPop, ...salsaChunks.hipSwitch, ...salsaChunks.chestPop, ...salsaChunks.turnPrep, ...salsaChunks.chestPop] },
                { name: "Salsa Chest Pop Endurance II", complexity: 5, sequence: [...salsaChunks.turnPrep, ...salsaChunks.chestPop, ...salsaChunks.hipCross, ...salsaChunks.chestPop, ...salsaChunks.shineHead] },
                { name: "Salsa Shine-Hip Fusion I", complexity: 5, sequence: [...salsaChunks.shineHead, ...salsaChunks.hipSwitch, ...salsaChunks.shineHands, ...salsaChunks.hipCross, ...salsaChunks.shineHead] },
                { name: "Salsa Shine-Hip Fusion II", complexity: 5, sequence: [...salsaChunks.hipCross, ...salsaChunks.shineHands, ...salsaChunks.hipSwitch, ...salsaChunks.shineHead, ...salsaChunks.hipCross] },
                { name: "Salsa Wave-Turn Fusion I", complexity: 5, sequence: [...salsaChunks.bodyWaveDown, ...salsaChunks.turnPrep, ...salsaChunks.bodyWaveUp, ...salsaChunks.turnSpiral, ...salsaChunks.fullBody] },
                { name: "Salsa Wave-Turn Fusion II", complexity: 5, sequence: [...salsaChunks.fullBody, ...salsaChunks.turnSpiral, ...salsaChunks.bodyWaveUp, ...salsaChunks.turnPrep, ...salsaChunks.bodyWaveDown] },
                { name: "Salsa Footwork Shine Endurance I", complexity: 5, sequence: [...salsaChunks.footworkLadder, ...salsaChunks.shineHead, ...salsaChunks.footworkBasic, ...salsaChunks.shineHands, ...salsaChunks.chestPop] },
                { name: "Salsa Footwork Shine Endurance II", complexity: 5, sequence: [...salsaChunks.shineHands, ...salsaChunks.footworkBasic, ...salsaChunks.shineHead, ...salsaChunks.footworkLadder, ...salsaChunks.turnPrep] },
                { name: "Salsa Hip Spiral Challenge I", complexity: 5, sequence: [...salsaChunks.hipSwitch, ...salsaChunks.turnSpiral, ...salsaChunks.hipCross, ...salsaChunks.turnPrep, ...salsaChunks.hipSwitch] },
                { name: "Salsa Hip Spiral Challenge II", complexity: 5, sequence: [...salsaChunks.turnPrep, ...salsaChunks.hipCross, ...salsaChunks.turnSpiral, ...salsaChunks.hipSwitch, ...salsaChunks.turnSpiral] },
                { name: "Salsa Full Circuit Showcase I", complexity: 5, sequence: [...salsaChunks.fullBody, ...salsaChunks.shineHead, ...salsaChunks.hipSwitch, ...salsaChunks.footworkBasic, ...salsaChunks.turnPrep] },
                { name: "Salsa Full Circuit Showcase II", complexity: 5, sequence: [...salsaChunks.turnPrep, ...salsaChunks.footworkLadder, ...salsaChunks.hipCross, ...salsaChunks.shineHands, ...salsaChunks.fullBody] },
            ],

            bachata: [
                // Complexity 1 (4)
                { name: "Bachata Sensual Wave Mini", complexity: 1, sequence: [...bachataChunks.sensualWave] },
                { name: "Bachata Hip Circle Mini", complexity: 1, sequence: [...bachataChunks.hipCircle] },
                { name: "Bachata Step Touch Mini", complexity: 1, sequence: [...bachataChunks.stepTouch] },
                { name: "Bachata Shoulder Roll Mini", complexity: 1, sequence: [...bachataChunks.shoulderRoll] },

                // Complexity 2 (6) - 10 moves
                { name: "Bachata Wave + Return", complexity: 2, sequence: [...bachataChunks.sensualWave, ...bachataChunks.waveReturn] },
                { name: "Bachata Hip Circle + Sway", complexity: 2, sequence: [...bachataChunks.hipCircle, ...bachataChunks.hipSway] },
                { name: "Bachata Hands to Hips", complexity: 2, sequence: [...bachataChunks.handToHip, ...bachataChunks.handsFrame] },
                { name: "Bachata Step Touch + Roll", complexity: 2, sequence: [...bachataChunks.stepTouch, ...bachataChunks.bodyRoll] },
                { name: "Bachata Shoulder + Head Accent", complexity: 2, sequence: [...bachataChunks.shoulderRoll, ...bachataChunks.headAccent] },
                { name: "Bachata Soft Wave + Hip Sway", complexity: 2, sequence: [...bachataChunks.softWave, ...bachataChunks.hipSway] },

                // Complexity 3 (10) - 15 moves
                { name: "Bachata Sensual Builder I", complexity: 3, sequence: [...bachataChunks.sensualWave, ...bachataChunks.softWave, ...bachataChunks.hipSway] },
                { name: "Bachata Sensual Builder II", complexity: 3, sequence: [...bachataChunks.softWave, ...bachataChunks.sensualWave, ...bachataChunks.bodyRoll] },
                { name: "Bachata Hip Circle Chain", complexity: 3, sequence: [...bachataChunks.hipCircle, ...bachataChunks.bodyRoll, ...bachataChunks.hipCircle] },
                { name: "Bachata Step & Frame Combo", complexity: 3, sequence: [...bachataChunks.stepTouch, ...bachataChunks.handsFrame, ...bachataChunks.stepSync] },
                { name: "Bachata Shoulder-Head Groove", complexity: 3, sequence: [...bachataChunks.headAccent, ...bachataChunks.shoulderRoll, ...bachataChunks.headAccent] },
                { name: "Bachata Hand to Hip Flow", complexity: 3, sequence: [...bachataChunks.handToHip, ...bachataChunks.hipSway, ...bachataChunks.handToHip] },
                { name: "Bachata Wave Return Mix", complexity: 3, sequence: [...bachataChunks.sensualWave, ...bachataChunks.waveReturn, ...bachataChunks.softWave] },
                { name: "Bachata Step Roll Builder", complexity: 3, sequence: [...bachataChunks.stepSync, ...bachataChunks.bodyRoll, ...bachataChunks.stepTouch] },
                { name: "Bachata Hip Sway Endurance", complexity: 3, sequence: [...bachataChunks.hipSway, ...bachataChunks.hipCircle, ...bachataChunks.hipSway] },
                { name: "Bachata Frame & Wave Combo", complexity: 3, sequence: [...bachataChunks.handsFrame, ...bachataChunks.sensualWave, ...bachataChunks.waveReturn] },

                // Complexity 4 (18) - 20 moves
                { name: "Bachata Sensual Marathon I", complexity: 4, sequence: [...bachataChunks.sensualWave, ...bachataChunks.softWave, ...bachataChunks.waveReturn, ...bachataChunks.bodyRoll] },
                { name: "Bachata Sensual Marathon II", complexity: 4, sequence: [...bachataChunks.softWave, ...bachataChunks.bodyRoll, ...bachataChunks.sensualWave, ...bachataChunks.waveReturn] },
                { name: "Bachata Hip Groove Marathon I", complexity: 4, sequence: [...bachataChunks.hipCircle, ...bachataChunks.hipSway, ...bachataChunks.hipCircle, ...bachataChunks.softWave] },
                { name: "Bachata Hip Groove Marathon II", complexity: 4, sequence: [...bachataChunks.hipSway, ...bachataChunks.hipCircle, ...bachataChunks.softWave, ...bachataChunks.hipSway] },
                { name: "Bachata Step & Roll Marathon I", complexity: 4, sequence: [...bachataChunks.stepTouch, ...bachataChunks.stepSync, ...bachataChunks.bodyRoll, ...bachataChunks.stepTouch] },
                { name: "Bachata Step & Roll Marathon II", complexity: 4, sequence: [...bachataChunks.bodyRoll, ...bachataChunks.stepSync, ...bachataChunks.stepTouch, ...bachataChunks.bodyRoll] },
                { name: "Bachata Frame Builder I", complexity: 4, sequence: [...bachataChunks.handsFrame, ...bachataChunks.handToHip, ...bachataChunks.handsFrame, ...bachataChunks.shoulderRoll] },
                { name: "Bachata Frame Builder II", complexity: 4, sequence: [...bachataChunks.handToHip, ...bachataChunks.handsFrame, ...bachataChunks.shoulderRoll, ...bachataChunks.handToHip] },
                { name: "Bachata Shoulder Accent Run I", complexity: 4, sequence: [...bachataChunks.shoulderRoll, ...bachataChunks.headAccent, ...bachataChunks.shoulderRoll, ...bachataChunks.softWave] },
                { name: "Bachata Shoulder Accent Run II", complexity: 4, sequence: [...bachataChunks.headAccent, ...bachataChunks.shoulderRoll, ...bachataChunks.softWave, ...bachataChunks.headAccent] },
                { name: "Bachata Wave-Circle Blend I", complexity: 4, sequence: [...bachataChunks.sensualWave, ...bachataChunks.hipCircle, ...bachataChunks.waveReturn, ...bachataChunks.hipSway] },
                { name: "Bachata Wave-Circle Blend II", complexity: 4, sequence: [...bachataChunks.hipSway, ...bachataChunks.waveReturn, ...bachataChunks.hipCircle, ...bachataChunks.sensualWave] },
                { name: "Bachata Soft Groove Run I", complexity: 4, sequence: [...bachataChunks.softWave, ...bachataChunks.hipSway, ...bachataChunks.softWave, ...bachataChunks.bodyRoll] },
                { name: "Bachata Soft Groove Run II", complexity: 4, sequence: [...bachataChunks.bodyRoll, ...bachataChunks.softWave, ...bachataChunks.hipCircle, ...bachataChunks.softWave] },
                { name: "Bachata Step-Frame Blend I", complexity: 4, sequence: [...bachataChunks.stepTouch, ...bachataChunks.handsFrame, ...bachataChunks.stepSync, ...bachataChunks.handToHip] },
                { name: "Bachata Step-Frame Blend II", complexity: 4, sequence: [...bachataChunks.handToHip, ...bachataChunks.stepSync, ...bachataChunks.handsFrame, ...bachataChunks.stepTouch] },
                { name: "Bachata Circle-Accent Blend I", complexity: 4, sequence: [...bachataChunks.hipCircle, ...bachataChunks.headAccent, ...bachataChunks.hipSway, ...bachataChunks.headAccent] },
                { name: "Bachata Circle-Accent Blend II", complexity: 4, sequence: [...bachataChunks.headAccent, ...bachataChunks.hipCircle, ...bachataChunks.headAccent, ...bachataChunks.hipSway] },

                // Complexity 5 (22) - 25 moves
                { name: "Bachata Ultimate Sensual I", complexity: 5, sequence: [...bachataChunks.sensualWave, ...bachataChunks.softWave, ...bachataChunks.waveReturn, ...bachataChunks.bodyRoll, ...bachataChunks.sensualWave] },
                { name: "Bachata Ultimate Sensual II", complexity: 5, sequence: [...bachataChunks.softWave, ...bachataChunks.sensualWave, ...bachataChunks.bodyRoll, ...bachataChunks.waveReturn, ...bachataChunks.softWave] },
                { name: "Bachata Hip Mastery I", complexity: 5, sequence: [...bachataChunks.hipCircle, ...bachataChunks.hipSway, ...bachataChunks.hipCircle, ...bachataChunks.hipSway, ...bachataChunks.bodyRoll] },
                { name: "Bachata Hip Mastery II", complexity: 5, sequence: [...bachataChunks.hipSway, ...bachataChunks.hipCircle, ...bachataChunks.bodyRoll, ...bachataChunks.hipSway, ...bachataChunks.hipCircle] },
                { name: "Bachata Step Endurance I", complexity: 5, sequence: [...bachataChunks.stepTouch, ...bachataChunks.stepSync, ...bachataChunks.stepTouch, ...bachataChunks.bodyRoll, ...bachataChunks.stepSync] },
                { name: "Bachata Step Endurance II", complexity: 5, sequence: [...bachataChunks.stepSync, ...bachataChunks.stepTouch, ...bachataChunks.bodyRoll, ...bachataChunks.stepTouch, ...bachataChunks.stepSync] },
                { name: "Bachata Frame & Hips I", complexity: 5, sequence: [...bachataChunks.handsFrame, ...bachataChunks.handToHip, ...bachataChunks.hipSway, ...bachataChunks.hipCircle, ...bachataChunks.handsFrame] },
                { name: "Bachata Frame & Hips II", complexity: 5, sequence: [...bachataChunks.handToHip, ...bachataChunks.handsFrame, ...bachataChunks.hipCircle, ...bachataChunks.hipSway, ...bachataChunks.handToHip] },
                { name: "Bachata Shoulder Accent Gauntlet I", complexity: 5, sequence: [...bachataChunks.shoulderRoll, ...bachataChunks.headAccent, ...bachataChunks.shoulderRoll, ...bachataChunks.headAccent, ...bachataChunks.softWave] },
                { name: "Bachata Shoulder Accent Gauntlet II", complexity: 5, sequence: [...bachataChunks.headAccent, ...bachataChunks.shoulderRoll, ...bachataChunks.softWave, ...bachataChunks.shoulderRoll, ...bachataChunks.headAccent] },
                { name: "Bachata Wave-Circle Gauntlet I", complexity: 5, sequence: [...bachataChunks.sensualWave, ...bachataChunks.hipCircle, ...bachataChunks.waveReturn, ...bachataChunks.hipSway, ...bachataChunks.softWave] },
                { name: "Bachata Wave-Circle Gauntlet II", complexity: 5, sequence: [...bachataChunks.softWave, ...bachataChunks.hipSway, ...bachataChunks.waveReturn, ...bachataChunks.hipCircle, ...bachataChunks.sensualWave] },
                { name: "Bachata Roll & Frame Gauntlet I", complexity: 5, sequence: [...bachataChunks.bodyRoll, ...bachataChunks.handsFrame, ...bachataChunks.handToHip, ...bachataChunks.bodyRoll, ...bachataChunks.softWave] },
                { name: "Bachata Roll & Frame Gauntlet II", complexity: 5, sequence: [...bachataChunks.handsFrame, ...bachataChunks.bodyRoll, ...bachataChunks.softWave, ...bachataChunks.handToHip, ...bachataChunks.bodyRoll] },
                { name: "Bachata Step-Frame Gauntlet I", complexity: 5, sequence: [...bachataChunks.stepTouch, ...bachataChunks.handsFrame, ...bachataChunks.stepSync, ...bachataChunks.handToHip, ...bachataChunks.stepTouch] },
                { name: "Bachata Step-Frame Gauntlet II", complexity: 5, sequence: [...bachataChunks.handToHip, ...bachataChunks.stepSync, ...bachataChunks.handsFrame, ...bachataChunks.stepTouch, ...bachataChunks.bodyRoll] },
                { name: "Bachata Soft Sensual Showcase I", complexity: 5, sequence: [...bachataChunks.softWave, ...bachataChunks.sensualWave, ...bachataChunks.waveReturn, ...bachataChunks.softWave, ...bachataChunks.hipCircle] },
                { name: "Bachata Soft Sensual Showcase II", complexity: 5, sequence: [...bachataChunks.hipCircle, ...bachataChunks.softWave, ...bachataChunks.waveReturn, ...bachataChunks.sensualWave, ...bachataChunks.softWave] },
                { name: "Bachata Head-Shoulder Spotlight I", complexity: 5, sequence: [...bachataChunks.headAccent, ...bachataChunks.shoulderRoll, ...bachataChunks.headAccent, ...bachataChunks.handsFrame, ...bachataChunks.shoulderRoll] },
                { name: "Bachata Head-Shoulder Spotlight II", complexity: 5, sequence: [...bachataChunks.shoulderRoll, ...bachataChunks.handsFrame, ...bachataChunks.headAccent, ...bachataChunks.shoulderRoll, ...bachataChunks.headAccent] },
                { name: "Bachata Full Showcase I", complexity: 5, sequence: [...bachataChunks.sensualWave, ...bachataChunks.stepTouch, ...bachataChunks.handToHip, ...bachataChunks.hipSway, ...bachataChunks.bodyRoll] },
                { name: "Bachata Full Showcase II", complexity: 5, sequence: [...bachataChunks.bodyRoll, ...bachataChunks.hipCircle, ...bachataChunks.handsFrame, ...bachataChunks.stepSync, ...bachataChunks.sensualWave] },
            ],
        };

        let activeStyle = "salsa";
        let activeMission = null;
        let progressIndex = 0;
        let selectedComplexity = null; // null = no filter, 0-5 = specific complexity
        let missionHistory = []; // Array to store mission history
        let currentHistoryIndex = -1; // Current position in history (-1 means no history)
        let missionStartTime = null; // Track when mission started
        let sequenceRecords = {}; // Cache for sequence records
        let poolIndexByKey = {}; // Tracks next mission index per (style+complexity filter)

        const statusEl = document.getElementById("status");
        const statusMessageEl = document.getElementById("status-message");
        const sequenceEl = document.getElementById("sequence");
        const liveTimerEl = document.getElementById("live-timer");
        const parts = Array.from(document.querySelectorAll(".part"));
        const complexityModal = document.getElementById("complexity-modal");
        const complexityFilterBtn = document.getElementById("complexity-filter");

        // Wrap part labels so "fun random transforms" don't override the part's absolute positioning transforms
        parts.forEach((part) => {
            if (part.querySelector(".part-inner")) return;
            const inner = document.createElement("span");
            inner.className = "part-inner";
            while (part.firstChild) inner.appendChild(part.firstChild);
            part.appendChild(inner);
        });

        function setStyle(style) {
            activeStyle = style;
            document.getElementById("style-salsa").classList.toggle("active", style === "salsa");
            document.getElementById("style-bachata").classList.toggle("active", style === "bachata");
            resetMission();
            // Reset sequential pointer for this style+filter
            poolIndexByKey = {};
            statusMessageEl.textContent = "Tap \"Next Mission\" to begin a " + style + " sequence.";
        }

        function renderSequence() {
            sequenceEl.innerHTML = "";
            if (!activeMission) return;
            
            // Show only the next move that needs to be pressed
            if (progressIndex < activeMission.sequence.length) {
                const nextPart = activeMission.sequence[progressIndex];
                const pill = document.createElement("span");
                pill.textContent = nextPart.replace("-", " ");
                pill.classList.add("active");
                sequenceEl.appendChild(pill);
            }
        }

        function updateTargetHighlight() {
            parts.forEach((part) => {
                part.classList.remove("target", "correct", "wrong");
                // Target highlighting removed - user must find the next move themselves
            });
        }

        function getComplexityLabel(level) {
            const labels = ["", "Easy", "Easy-Medium", "Medium", "Medium-Hard", "Hard"];
            return labels[level] || "Unknown";
        }

        let timerRafId = null;
        function stopLiveTimer(clear = false) {
            if (timerRafId) {
                cancelAnimationFrame(timerRafId);
                timerRafId = null;
            }
            if (clear && liveTimerEl) liveTimerEl.textContent = "";
        }

        function startLiveTimer() {
            stopLiveTimer(false);
            if (!liveTimerEl) return;
            if (!activeMission || missionStartTime === null) {
                liveTimerEl.textContent = "";
                return;
            }

            const tick = () => {
                if (!activeMission || missionStartTime === null) {
                    stopLiveTimer(false);
                    return;
                }
                const elapsed = (performance.now() - missionStartTime) / 1000;
                liveTimerEl.textContent = formatTime(elapsed);
                timerRafId = requestAnimationFrame(tick);
            };
            timerRafId = requestAnimationFrame(tick);
        }

        function getPoolKey(style = activeStyle) {
            const filter = (selectedComplexity !== null && selectedComplexity !== 0) ? String(selectedComplexity) : "all";
            return `${style}_${filter}`;
        }

        function getCurrentPool(style = activeStyle) {
            let pool = missions[style] || [];
            if (selectedComplexity !== null && selectedComplexity !== 0) {
                pool = pool.filter((mission) => mission.complexity === selectedComplexity);
            }
            return pool;
        }

        function getNextMissionFromPool() {
            const pool = getCurrentPool(activeStyle);
            if (pool.length === 0) {
                statusMessageEl.textContent = (selectedComplexity !== null && selectedComplexity !== 0)
                    ? `No missions found for complexity ${selectedComplexity}. Try a different filter.`
                    : "No missions available.";
                return null;
            }

            const key = getPoolKey(activeStyle);
            let idx = poolIndexByKey[key] ?? 0;
            if (idx < 0 || idx >= pool.length) idx = 0;

            const mission = pool[idx];
            poolIndexByKey[key] = (idx + 1) % pool.length;
            return mission;
        }

        function setNextIndexAfterMission(mission) {
            const pool = getCurrentPool(activeStyle);
            const idx = pool.findIndex((m) => m.name === mission.name);
            if (idx >= 0) {
                poolIndexByKey[getPoolKey(activeStyle)] = (idx + 1) % pool.length;
            }
        }

        function loadMission(mission, style, savedProgress = 0) {
            activeMission = mission;
            activeStyle = style;
            progressIndex = savedProgress;
            missionStartTime = savedProgress === 0 ? performance.now() : null; // Only start timer if starting fresh
            const complexity = activeMission.complexity || 1;
            const complexityLabel = getComplexityLabel(complexity);
            const complexityBadge = `<span class="complexity complexity-${complexity}">${complexityLabel} (${complexity}/5)</span>`;
            statusMessageEl.innerHTML = activeMission.name + complexityBadge;
            renderSequence();
            updateTargetHighlight();
            // Update style buttons
            document.getElementById("style-salsa").classList.toggle("active", style === "salsa");
            document.getElementById("style-bachata").classList.toggle("active", style === "bachata");
            // Load and display record for this sequence
            loadSequenceRecord(mission.name, style);
            startLiveTimer();
            // Start random pulsing for all body parts
            startRandomPulsing();
        }

        function startRandomPulsing() {
            // Remove any existing pulse classes
            parts.forEach(part => {
                part.classList.remove('random-pulse-1', 'random-pulse-2', 'random-pulse-3', 'random-pulse-4', 'random-pulse-5');
            });
            
            // Assign random pulse animations to each part with slight delay for variety
            parts.forEach((part, index) => {
                const pulseType = Math.floor(Math.random() * 5) + 1;
                // Add a small random delay to make pulsing more varied
                setTimeout(() => {
                    part.classList.add(`random-pulse-${pulseType}`);
                }, Math.random() * 500);
            });
        }

        function stopRandomPulsing() {
            parts.forEach(part => {
                part.classList.remove('random-pulse-1', 'random-pulse-2', 'random-pulse-3', 'random-pulse-4', 'random-pulse-5');
            });
        }

        function startMission() {
            let pool = getCurrentPool(activeStyle);
            
            if (pool.length === 0) {
                statusMessageEl.textContent = (selectedComplexity !== null && selectedComplexity !== 0)
                    ? `No missions found for complexity ${selectedComplexity}. Try a different filter.`
                    : "No missions available.";
                return;
            }
            
            // Select a random mission from the pool
            const newMission = pool[Math.floor(Math.random() * pool.length)];
            
            // If we're not at the end of history, remove everything after current index
            if (currentHistoryIndex < missionHistory.length - 1) {
                missionHistory = missionHistory.slice(0, currentHistoryIndex + 1);
            }
            
            // Add new mission to history
            missionHistory.push({
                mission: newMission,
                style: activeStyle,
                progressIndex: 0
            });
            currentHistoryIndex = missionHistory.length - 1;
            
            loadMission(newMission, activeStyle, 0);
        }

        function resetMission() {
            activeMission = null;
            progressIndex = 0;
            sequenceEl.innerHTML = "";
            updateTargetHighlight();
            missionHistory = [];
            currentHistoryIndex = -1;
            missionStartTime = null;
            stopLiveTimer(true);
            stopRandomPulsing();
        }

        function previousMission() {
            if (currentHistoryIndex > 0) {
                currentHistoryIndex--;
                const historyItem = missionHistory[currentHistoryIndex];
                loadMission(historyItem.mission, historyItem.style, historyItem.progressIndex);
            } else {
                statusMessageEl.textContent = "No previous mission. Tap Next Mission to begin.";
            }
        }

        function nextMission() {
            if (currentHistoryIndex < missionHistory.length - 1) {
                // Go forward in history
                currentHistoryIndex++;
                const historyItem = missionHistory[currentHistoryIndex];
                loadMission(historyItem.mission, historyItem.style, historyItem.progressIndex);
            } else {
                // Start a new mission
                startMission();
            }
        }

        function handleTap(partName, element) {
            if (!activeMission) {
                return;
            }

            const expected = activeMission.sequence[progressIndex];
            parts.forEach((part) => part.classList.remove("correct", "wrong"));

            if (partName === expected) {
                element.classList.add("correct");
                progressIndex += 1;
                
                // Update progress in history
                if (currentHistoryIndex >= 0 && currentHistoryIndex < missionHistory.length) {
                    missionHistory[currentHistoryIndex].progressIndex = progressIndex;
                }
                
                if (progressIndex >= activeMission.sequence.length) {
                    // Mission completed - calculate time
                    const completionTime = missionStartTime ? (performance.now() - missionStartTime) / 1000 : null; // Convert to seconds
                    const complexity = activeMission.complexity || 1;
                    const complexityLabel = getComplexityLabel(complexity);
                    const complexityBadge = `<span class="complexity complexity-${complexity}">${complexityLabel} (${complexity}/5)</span>`;
                    
                    let completionMsg = "Nice! Mission complete: " + activeMission.name + complexityBadge;
                    if (completionTime !== null) {
                        const timeStr = formatTime(completionTime);
                        showNotification(`Time: ${timeStr}`, "success", 6000);
                        // Check if this is a new record and save
                        checkAndSaveRecord(activeMission.name, activeStyle, completionTime);
                    }
                    statusMessageEl.innerHTML = completionMsg;
                    activeMission = null;
                    sequenceEl.innerHTML = "";
                    missionStartTime = null;
                    stopRandomPulsing();
                    stopLiveTimer(false);
                } else {
                    statusMessageEl.textContent = "Good! Next target...";
                }
            } else {
                element.classList.add("wrong");
                statusMessageEl.textContent = "Wrong spot. Restart this mission.";
                progressIndex = 0;
                missionStartTime = performance.now(); // Restart timer
                startLiveTimer();
                // Update progress in history
                if (currentHistoryIndex >= 0 && currentHistoryIndex < missionHistory.length) {
                    missionHistory[currentHistoryIndex].progressIndex = 0;
                }
            }

            renderSequence();
            // Don't call updateTargetHighlight() here as it removes correct/wrong classes
            // updateTargetHighlight();
            
            // Remove correct/wrong classes after animation completes
            setTimeout(() => {
                element.classList.remove("correct", "wrong");
            }, 700);
        }


        let toastTimeoutId = null;
        function showNotification(message, type = "info", durationMs = 2500) {
            const toast = document.getElementById("toast");
            if (!toast) return;

            toast.textContent = message;
            toast.classList.remove("success", "error");
            if (type === "success") toast.classList.add("success");
            if (type === "error") toast.classList.add("error");
            toast.classList.add("show");

            if (toastTimeoutId) clearTimeout(toastTimeoutId);
            toastTimeoutId = setTimeout(() => {
                toast.classList.remove("show");
            }, durationMs);
        }

        parts.forEach((part) => {
            part.addEventListener("pointerdown", (event) => {
                event.preventDefault();
                handleTap(part.dataset.part, part);
            });
        });

        // Welcome modal
        const welcomeModal = document.getElementById("welcome-modal");
        const closeWelcomeBtn = document.getElementById("close-welcome");
        
        // Show welcome modal on page load
        welcomeModal.classList.add("show");
        
        closeWelcomeBtn.addEventListener("click", () => {
            welcomeModal.classList.remove("show");
            localStorage.setItem("dance-wizard-welcome-shown", "true");
        });
        
        welcomeModal.addEventListener("click", (e) => {
            if (e.target === welcomeModal) {
                welcomeModal.classList.remove("show");
                localStorage.setItem("dance-wizard-welcome-shown", "true");
            }
        });

        function updateComplexityFilterButton() {
            if (selectedComplexity === null || selectedComplexity === 0) {
                complexityFilterBtn.textContent = "Complexity";
                complexityFilterBtn.classList.remove("filter-active");
            } else {
                const label = getComplexityLabel(selectedComplexity);
                complexityFilterBtn.textContent = `Filter: ${label}`;
                complexityFilterBtn.classList.add("filter-active");
            }
        }

        function selectComplexity(complexity) {
            if (complexity === 0) {
                selectedComplexity = null;
            } else {
                selectedComplexity = complexity;
            }
            // Reset sequential pointer for this filter and clear current mission/history
            resetMission();
            poolIndexByKey = {};
            updateComplexityFilterButton();
            complexityModal.classList.remove("show");
            
            // Update selected state in modal
            document.querySelectorAll(".complexity-option").forEach(option => {
                option.classList.remove("selected");
            });
            if (selectedComplexity !== null) {
                const selectedOption = document.querySelector(`[data-complexity="${selectedComplexity}"]`);
                if (selectedOption) selectedOption.classList.add("selected");
            }
        }

        // Open complexity filter modal
        complexityFilterBtn.addEventListener("click", () => {
            // Update selected state in modal
            document.querySelectorAll(".complexity-option").forEach(option => {
                option.classList.remove("selected");
            });
            if (selectedComplexity !== null && selectedComplexity !== 0) {
                const selectedOption = document.querySelector(`[data-complexity="${selectedComplexity}"]`);
                if (selectedOption) selectedOption.classList.add("selected");
            }
            complexityModal.classList.add("show");
        });

        // Close modal when clicking overlay
        complexityModal.addEventListener("click", (e) => {
            if (e.target === complexityModal) {
                complexityModal.classList.remove("show");
            }
        });

        // Handle complexity option clicks
        document.querySelectorAll(".complexity-option").forEach(option => {
            option.addEventListener("click", () => {
                const complexity = parseInt(option.dataset.complexity);
                selectComplexity(complexity);
            });
        });

        function formatTime(seconds) {
            const wholeSeconds = Math.floor(seconds);
            const milliseconds = Math.floor((seconds - wholeSeconds) * 1000);
            return `${wholeSeconds}.${milliseconds.toString().padStart(3, '0')}s`;
        }

        async function checkAndSaveRecord(sequenceName, style, completionTime) {
            try {
                // First check if there's an existing record
                const checkResponse = await fetch(`/api/dance-sequences/record/${encodeURIComponent(sequenceName)}/${style}`);
                let isNewRecord = false;
                let existingRecord = null;
                
                if (checkResponse.ok) {
                    existingRecord = await checkResponse.json();
                    // Check if new time is faster
                    if (completionTime < existingRecord.completion_time) {
                        isNewRecord = true;
                    }
                } else if (checkResponse.status === 404) {
                    // No existing record, so this is a new record
                    isNewRecord = true;
                }
                
                if (isNewRecord) {
                    // Prompt for user name
                    const userName = prompt(`ðŸŽ‰ New Record! ${formatTime(completionTime)}\n\nEnter your name to save this record:`);
                    if (userName && userName.trim()) {
                        await saveSequenceRecord(sequenceName, style, completionTime, userName.trim());
                    } else if (userName !== null) {
                        // User cancelled or entered empty name, still save without name
                        await saveSequenceRecord(sequenceName, style, completionTime, null);
                    }
                } else {
                    // Not a new record, just save normally
                    await saveSequenceRecord(sequenceName, style, completionTime, null);
                }
            } catch (error) {
                console.error('Failed to check/save sequence record:', error);
            }
        }

        async function saveSequenceRecord(sequenceName, style, completionTime, userName = null) {
            try {
                const response = await fetch('/api/dance-sequences/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sequence_name: sequenceName,
                        style: style,
                        completion_time: completionTime,
                        user_name: userName
                    })
                });
                
                if (response.ok) {
                    const record = await response.json();
                    sequenceRecords[`${sequenceName}_${style}`] = record;
                    // Reload the record display
                    loadSequenceRecord(sequenceName, style);
                }
            } catch (error) {
                console.error('Failed to save sequence record:', error);
            }
        }

        async function loadSequenceRecord(sequenceName, style) {
            const cacheKey = `${sequenceName}_${style}`;
            if (sequenceRecords[cacheKey]) {
                // Fast render from cache while fetching fresh data
                displaySequenceRecord(sequenceName, style, sequenceRecords[cacheKey]);
            } else {
                displaySequenceRecord(sequenceName, style, null, true);
            }
            try {
                const response = await fetch(`/api/dance-sequences/record/${encodeURIComponent(sequenceName)}/${style}`);
                if (response.ok) {
                    const record = await response.json();
                    sequenceRecords[cacheKey] = record;
                    displaySequenceRecord(sequenceName, style, record);
                } else if (response.status === 404) {
                    // No record yet
                    displaySequenceRecord(sequenceName, style, null);
                }
            } catch (error) {
                console.error('Failed to load sequence record:', error);
            }
        }

        function displaySequenceRecord(sequenceName, style, record, isLoading = false) {
            // Find or create record display element
            let recordEl = document.getElementById('sequence-record');
            if (!recordEl) {
                recordEl = document.createElement('div');
                recordEl.id = 'sequence-record';
                recordEl.style.cssText = 'margin-top: 8px; font-size: 0.85rem; color: #ffd166; text-align: center; font-weight: 600;';
                const sequenceDiv = document.getElementById('sequence');
                if (sequenceDiv && sequenceDiv.parentNode) {
                    sequenceDiv.parentNode.insertBefore(recordEl, sequenceDiv);
                } else if (statusEl) {
                    statusEl.appendChild(recordEl);
                }
            }
            
            if (isLoading) {
                recordEl.textContent = 'ðŸ† Checking record...';
            } else if (record) {
                const timeStr = formatTime(record.completion_time);
                const userName = (record.user_name && record.user_name.trim()) ? ` by ${record.user_name.trim()}` : '';
                recordEl.textContent = `ðŸ† Best time: ${timeStr}${userName}`;
            } else {
                recordEl.textContent = 'ðŸ† No record yet - be the first!';
            }
        }

        function tryAgain() {
            // If mission finished, activeMission is null but history still has it.
            if (!activeMission) {
                if (currentHistoryIndex >= 0 && currentHistoryIndex < missionHistory.length) {
                    const historyItem = missionHistory[currentHistoryIndex];
                    historyItem.progressIndex = 0;
                    loadMission(historyItem.mission, historyItem.style, 0);
                    return;
                }
                statusMessageEl.textContent = "No active mission. Tap Next Mission to begin.";
                return;
            }

            // Restart current mission
            progressIndex = 0;
            missionStartTime = performance.now();
            startLiveTimer();

            // Update history if applicable
            if (currentHistoryIndex >= 0 && currentHistoryIndex < missionHistory.length) {
                missionHistory[currentHistoryIndex].progressIndex = 0;
            }

            // Clear all visual feedback
            parts.forEach((part) => {
                part.classList.remove("correct", "wrong", "target");
            });

            // Update status message with mission info
            const complexity = activeMission.complexity || 1;
            const complexityLabel = getComplexityLabel(complexity);
            const complexityBadge = `<span class="complexity complexity-${complexity}">${complexityLabel} (${complexity}/5)</span>`;
            statusMessageEl.innerHTML = activeMission.name + complexityBadge;

            // Render the first move
            renderSequence();
            updateTargetHighlight();
        }

        function populateMissionOptions(searchTerm = "") {
            const missionOptionsEl = document.getElementById("mission-options");
            if (!missionOptionsEl) return;
            
            missionOptionsEl.innerHTML = "";
            const availableMissions = missions[activeStyle];
            const searchLower = searchTerm.toLowerCase().trim();
            
            const filteredMissions = availableMissions.filter(mission => {
                return mission.name.toLowerCase().includes(searchLower);
            });
            
            if (filteredMissions.length === 0) {
                const noResults = document.createElement("div");
                noResults.className = "mission-option";
                noResults.style.textAlign = "center";
                noResults.style.opacity = "0.7";
                noResults.textContent = "No missions found";
                missionOptionsEl.appendChild(noResults);
                return;
            }
            
            filteredMissions.forEach(mission => {
                const option = document.createElement("div");
                option.className = "mission-option";
                option.dataset.missionName = mission.name;
                
                const complexity = mission.complexity || 1;
                const complexityLabel = getComplexityLabel(complexity);
                const complexityBadge = `<span class="complexity complexity-${complexity}">${complexityLabel} (${complexity}/5)</span>`;
                
                option.innerHTML = `
                    <div class="mission-name">${mission.name}</div>
                    <div class="mission-details">${complexityBadge} â€¢ ${mission.sequence.length} moves</div>
                `;
                
                option.addEventListener("click", () => {
                    selectMission(mission);
                });
                
                missionOptionsEl.appendChild(option);
            });
        }

        function selectMission(mission) {
            // Ensure the sequential pointer continues AFTER the selected mission
            // Add to history
            if (currentHistoryIndex < missionHistory.length - 1) {
                missionHistory = missionHistory.slice(0, currentHistoryIndex + 1);
            }
            
            missionHistory.push({
                mission: mission,
                style: activeStyle,
                progressIndex: 0
            });
            currentHistoryIndex = missionHistory.length - 1;
            
            // Load the selected mission
            loadMission(mission, activeStyle, 0);
            
            // Close modal
            document.getElementById("select-mission-modal").classList.remove("show");
        }

        // Initialize button state
        updateComplexityFilterButton();

        document.getElementById("style-salsa").addEventListener("click", () => setStyle("salsa"));
        document.getElementById("style-bachata").addEventListener("click", () => setStyle("bachata"));
        document.getElementById("next-mission").addEventListener("click", nextMission);
        document.getElementById("previous-mission").addEventListener("click", previousMission);
        document.getElementById("try-again").addEventListener("click", tryAgain);
        document.getElementById("select-mission").addEventListener("click", () => {
            const searchInput = document.getElementById("mission-search");
            if (searchInput) {
                searchInput.value = "";
            }
            populateMissionOptions();
            document.getElementById("select-mission-modal").classList.add("show");
            // Focus on search input when modal opens
            setTimeout(() => {
                if (searchInput) searchInput.focus();
            }, 100);
        });

        // Add search functionality
        const missionSearchInput = document.getElementById("mission-search");
        if (missionSearchInput) {
            missionSearchInput.addEventListener("input", (e) => {
                populateMissionOptions(e.target.value);
            });
        }

        // Close select mission modal when clicking overlay
        document.getElementById("select-mission-modal").addEventListener("click", (e) => {
            if (e.target.id === "select-mission-modal") {
                document.getElementById("select-mission-modal").classList.remove("show");
            }
        });
    </script>
</body>
</html>
